* Docker Envs

Docker Envs is an extension to the docker concept by having
declarative environments that are associated with docker images. In
addition this tool does not require docker to build images. Thus
allowing for interesting caching behavior and tricks that docker would
not normally allow.

** References

 - [[https://docs.docker.com/registry/spec/api/][Docker Registry API Specification]]
 - Docker Image Specification
   - [[https://github.com/moby/moby/blob/master/image/spec/v1.2.md][Summary]]
   - [[https://docs.docker.com/registry/spec/manifest-v2-2/][Registry V2 Specification]]

** Saving a Docker Image for Inspection

Pull and ensure that filesystem exists

#+begin_src python :results none
  from docker_envs.docker.client import pull, save

  pull('continuumio/miniconda3', 'latest')
  save('continuumio/miniconda3', 'latest', '/tmp/miniconda3.tar')
#+end_src

Modify docker image from filesystem

#+begin_src python :results output
  from docker_envs.docker.base import Image

  images = Image.from_file('/tmp/miniconda3.tar')
  # images[0].remove_layer()
  images[0].name = 'this-is-a-test'
  images[0].add_layer_path('./')
  images[0].add_layer_contents({
      'this/is/a/test1': b'asdfasdf',
      'this/is/a/test2': b'asdfasdf'
  })
  images[0].write_file('example.tar')
#+end_src

Load docker image from the filesystem

#+begin_src python
  from docker_envs.docker.client import load

  load('example.tar')
#+end_src
